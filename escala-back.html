<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Escala de Folgas - MÃªs Completo</title>
<style>
			body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
              margin: 20px;
              background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
              color: #e0e6ed;
              min-height: 100vh;
			}
			
			body::before {
              content: '';
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                          radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%);
              pointer-events: none;
              z-index: -1;
			}
			
			h1 {
              text-align: center;
              margin-bottom: 20px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              background-clip: text;
              font-size: 2.5rem;
              font-weight: 700;
              text-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
			}
			
        	/*clamp(valor mÃ­nimo, valor ideal, valor mÃ¡ximo)*/
			.token {
              text-align: center;
              margin-bottom: 20px;
			}
			.token button {
              padding: 15px 30px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              border: none;
              border-radius: 12px;
              cursor: pointer;
              transition: all 0.3s ease;
              font-weight: 600;
              font-size: 20px;
              min-width: 120px;
              box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
              position: relative;
              overflow: hidden;
			}
			
			.token button::before {
              content: '';
              position: absolute;
              top: 0;
              left: -100%;
              width: 100%;
              height: 100%;
              background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
			  transition: left 0.5s;
			}
			
			.token button:hover::before {
              left: 100%;
			}
			
			.token button:hover {
              background: linear-gradient(135deg, #7c8efc 0%, #8a5fb8 100%);
              transform: translateY(-3px);
              box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
			}
			
			.token input {
              text-align: center;
              width: 700px;
              max-width: 90%;
              height: 50px;
              margin-bottom: 15px;
              background: rgba(255, 255, 255, 0.05);
              border: 2px solid rgba(102, 126, 234, 0.3);
              border-radius: 12px;
              color: #e0e6ed;
              padding: 15px;
              font-size: 16px;
              backdrop-filter: blur(10px);
              transition: all 0.3s ease;
			}
			
			.token input:focus {
              outline: none;
              border-color: #667eea;
              box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
              background: rgba(255, 255, 255, 0.08);
			}
			
			.token input::placeholder {
              color: #a0a6b0;
			}
            
          /**/  
          .notification {
			 position: fixed;
			 top: 15px;
			 left: 15px;
			 cursor: pointer;
			 width: clamp(45px, 10vw, 70px);
			 height: clamp(45px, 10vw, 70px);
			 display: flex;
			 align-items: center;
			 justify-content: center;
			 background: rgba(255, 255, 255, 0.05);
			 backdrop-filter: blur(10px);
			 border-radius: 15px;
			 border: 1px solid rgba(255, 255, 255, 0.1);
			 transition: all 0.3s ease;
            }
			
			.notification:hover {
              background: rgba(255, 255, 255, 0.1);
              transform: scale(1.05);
			}
			
			.notification img {
			    width: 100%;
			    height: auto;
			    aspect-ratio: 1 / 1;
			    filter: drop-shadow(0 0 5px rgba(102, 126, 234, 0.5));
			}
			.notification .counter {
			    position: absolute;
			    top: -5%;
			    right: -5%;
			    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
			    color: #fff;
			    filter: drop-shadow(0 0 10px rgba(255, 107, 107, 0.5));
			    border-radius: 50%;
			    display: flex;
			    padding: 5%;
			    width: 40%;
			    height: 40%;
			    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
			}		
      
            .notification .counter img {
                width: 100%;
                height: 100%;
                filter: none;
            }
			/**/   
			.controls {
              text-align: center;
              margin-bottom: 20px;
			}
			.controls select {
              padding: 12px 16px;
              margin-right: 10px;
              border: 2px solid rgba(102, 126, 234, 0.3);
              border-radius: 12px;
              background: rgba(255, 255, 255, 0.05);
              color: #e0e6ed;
              font-size: 16px;
              font-weight: 500;
              transition: all 0.3s ease;
              min-width: 180px;
              margin-bottom: 15px;
              backdrop-filter: blur(10px);
			}
			.controls select:focus {
              border-color: #667eea;
              outline: none;
              box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
              background: rgba(255, 255, 255, 0.08);
			}
			
			.controls select option {
              background: #1a1a2e;
              color: #e0e6ed;
              border: none;
			}
			
			.controls button {
              padding: 12px 25px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              border: none;
              border-radius: 12px;
              cursor: pointer;
              transition: all 0.3s ease;
              font-weight: 600;
              font-size: 20px;
              min-width: 140px;
              box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
              position: relative;
              overflow: hidden;
			}
			
			.controls button::before {
              content: '';
              position: absolute;
              top: 0;
              left: -100%;
              width: 100%;
              height: 100%;
              background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
              transition: left 0.5s;
			}
			
			.controls button:hover::before {
              left: 100%;
			}
			
			.controls button:hover {
              background: linear-gradient(135deg, #7c8efc 0%, #8a5fb8 100%);
              transform: translateY(-3px);
              box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
			}
			
			/* Modal styles */
			.modal {
              display: none;
              position: fixed;
              z-index: 1000;
              left: 0;
              top: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.8);
              backdrop-filter: blur(5px);
			}
			.modal-content, .access-modal {
              background: linear-gradient(135deg, rgba(26, 26, 46, 0.95) 0%, rgba(22, 33, 62, 0.95) 100%);
              margin: 1% auto;
              padding: 30px;
              border-radius: 20px;
              width: 50%;
              max-width: 750px;
              max-height: 95vh;
              overflow-y: auto;
              backdrop-filter: blur(20px);
              border: 1px solid rgba(255, 255, 255, 0.1);
              box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
			}
			.modal-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
              border-bottom: 1px solid rgba(255, 255, 255, 0.1);
              padding-bottom: 15px;
			}
			
			.modal-header h2 {
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              background-clip: text;
              margin: 0;
			}
			
			.close {
              color: #a0a6b0;
              font-size: 28px;
              font-weight: bold;
              cursor: pointer;
              transition: all 0.3s ease;
			}
			.close:hover {
              color: #667eea;
              transform: scale(1.1);
			}
			.form-group {
				margin-bottom: 20px;
			}
			.form-group label {
              display: block;
              margin-bottom: 8px;
              color: #e0e6ed;
              font-weight: 500;
			}
			.person-selection label, .date-selection label {
              font-weight: bold;
              font-size: 18px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              background-clip: text;
			}
			#scheduleModal label {
              font-size: 30px;
			}
			.form-group input, .form-group select, .form-group textarea {
              width: 100%;
              padding: 15px;
              border: 2px solid rgba(102, 126, 234, 0.3);
              border-radius: 12px;
              box-sizing: border-box;
              font-size: 20px;
              background: rgba(255, 255, 255, 0.05);
              color: #e0e6ed;
              backdrop-filter: blur(10px);
              transition: all 0.3s ease;
			}
			
			.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
              outline: none;
              border-color: #667eea;
              box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
              background: rgba(255, 255, 255, 0.08);
			}
			
			.form-group input::placeholder, .form-group textarea::placeholder {
              color: #a0a6b0;
			}
			
			.form-group select option {
              background: #1a1a2e;
              color: #e0e6ed;
			}
			
			.form-group textarea {
              height: 150px;
              resize: vertical;
			}
			.person-selection {
              display: flex;
              gap: 20px;
              margin-bottom: 15px;
			}
			.person-option {
              display: flex;
              align-items: center;
              gap: 8px;
			}
			.person-option input[type="radio"] {
              width: 20px;
              height: 20px;
              margin: 0;
              vertical-align: middle;
              accent-color: #667eea;
			}
			.date-selection {
              display: flex;
              gap: 10px;
              margin-bottom: 15px;
			}
			.date-selection select {
              flex: 1;
			}
            #tokenInput:hover {
                cursor: text; /* Adiciona o cursor de texto ao passar o mouse */
            }
			.modal-buttons button, .access-button {
              padding: 15px 30px;
              margin-right: 30px;
              border: none;
              border-radius: 12px;
              cursor: pointer;
              font-size: 20px;
              transition: all 0.3s ease;
              font-weight: 600;
              min-width: 120px;
              margin-bottom: 15px;
              box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
              position: relative;
              overflow: hidden;
			}
			
			.modal-buttons button::before, .access-button::before {
              content: '';
              position: absolute;
              top: 0;
              left: -100%;
              width: 100%;
              height: 100%;
              background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
              transition: left 0.5s;
			}
			
			.modal-buttons button:hover::before {
              left: 100%;
			}
			
			.modal-step {
              min-height: 200px;
			}
			.modal-step.hidden {
              display: none !important;
			}
			.btn-primary, .access-button {
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
			}
			.btn-primary:hover {
              background: linear-gradient(135deg, #7c8efc 0%, #8a5fb8 100%);
              transform: translateY(-3px);
              box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
			}
			.btn-secondary {
              background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
              color: white;
			}
			.btn-secondary:hover, .access-button:hover {
              background: linear-gradient(135deg, #7a8085 0%, #65696e 100%);
              transform: translateY(-3px);
              box-shadow: 0 12px 35px rgba(108, 117, 125, 0.4);
			}
			.editable-calendar {
              margin: 20px 0;
			}
			.editable-calendar table {
              width: 100%;
              max-width: 500px;
              margin: 0 auto;
              background: rgba(255, 255, 255, 0.03);
              border-radius: 15px;
              overflow: hidden;
              backdrop-filter: blur(10px);
			}
			.day-checkbox {
              display: flex;
              flex-direction: column;
              align-items: center;
              gap: 5px;
			}
			.day-checkbox input[type="checkbox"] {
              width: 18px;
              height: 18px;
              margin: 0;
              accent-color: #667eea;
			}
			.day-checkbox label {
              font-size: 14px;
              cursor: pointer;
              margin: 0;
              color: #e0e6ed;
			}
			.editable-calendar td {
              padding: 10px 5px;
              text-align: center;
              border: 1px solid rgba(255, 255, 255, 0.1);
			}
			.editable-calendar .empty {
              background: rgba(245, 245, 245, 0.05);
			}
			.toggle-input-link {
              text-align: right;
              margin: 15px 0;
			}
			.toggle-input-link a {
              color: #667eea;
              text-decoration: none;
              font-size: 16px;
              transition: all 0.3s ease;
			}
			.toggle-input-link a:hover {
              text-decoration: underline;
              color: #7c8efc;
              text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
			}
			table {
              padding: 8px 4px;
              width: 850px;
              margin: auto;
              border-collapse: collapse;
              table-layout: fixed;
              background: rgba(255, 255, 255, 0.03);
              border-radius: 15px;
              overflow: hidden;
              backdrop-filter: blur(10px);
              box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
			}
			th, td {
              border: 1px solid rgba(255, 255, 255, 0.1);
              text-align: center;
              padding: 12px 8px;
              vertical-align: top;
              word-wrap: break-word;
			}
			th {
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              font-weight: 600;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
			}
			.weekend {
              background: linear-gradient(135deg, rgba(26, 188, 156, 0.2) 0%, rgba(22, 160, 133, 0.2) 100%);
              color: #1abc9c;
              border: 1px solid rgba(26, 188, 156, 0.3);
			}
			.workday {
              background: linear-gradient(135deg, rgba(26, 188, 156, 0.2) 0%, rgba(22, 160, 133, 0.2) 100%);
              color: #1abc9c;
              border: 1px solid rgba(26, 188, 156, 0.3);
			}
			.cris-day-off {
              background: linear-gradient(135deg, rgba(255, 192, 203, 0.3) 0%, rgba(255, 182, 193, 0.3) 100%);
              color: #ff69b4;
              border: 1px solid rgba(255, 192, 203, 0.4);
			}
			.clei-day-off {
              background: linear-gradient(135deg, rgba(184, 218, 255, 0.3) 0%, rgba(173, 216, 230, 0.3) 100%);
              color: #4da6ff;
              border: 1px solid rgba(184, 218, 255, 0.4);
			}
			.person-name {
              font-weight: bold;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
			}
			.loading {
              text-align: center;
              padding: 20px;
              color: #a0a6b0;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              background-clip: text;
			}
			
			@keyframes popupSlideIn {
              from {
                opacity: 0;
                transform: translate(-50%, -60%);
              }
              to {
                opacity: 1;
                transform: translate(-50%, -50%);
              }
			}
			@media only screen and (max-width: 768px) {
			body {
			background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
			}
			
			#calendar-body td {
			font-size: 12px;
			}
			table {
			width: 100%;
			font-size: 16px;
			margin: 10px;
			border-radius: 10px;
			}
			table thead th {
			font-size: 11px;
			padding: 5px;
			}
			th, td {
			padding: 8px;
			}
			.controls {
			width: 100%;
			padding: 10px;
			}
			.token {
			width: 100%;
			padding: 10px;
			}
			
			.token input {
			width: 95%;
			}
			
			.modal-content, .access-modal {
			width: 90%;
			margin: 5% auto;
			padding: 20px;
			border-radius: 15px;
			}
		}
		</style>
	</head>
	<body>
    
    <section class="access-modal" id="accessModal">
    	<h1>Escalas Match</h1>        
        <h3>Acesso Restrito</h3>
        <p>Por favor, insira o token para continuar.</p>
        <input class="access-button" type="password" id="tokenInput" placeholder="Digite o token aqui" required>
        <button class="access-button" id="accessButton">Acessar</button>
        <p id="statusMessage"></p>
    </section>       
    	
    <div class="notification">
        <img src="https://cdn.jsdelivr.net/gh/zyon-king/escalas@main/notification-new.svg" alt="Sino Gradient Icon" />
        <span class="counter">
            <img src="https://cdn.jsdelivr.net/gh/zyon-king/escalas@main/counter-new.svg" alt="Counter Icon" />
        </span>
    </div>
        
		<div class="controls">    
			<h1>Escala de Folgas</h1>        
			<select id="month-select">
				<option value="">Carregando...</option>
			</select>
			<button id="add-schedule-btn">Editar Folgas</button>
		</div>
        
		<div id="loading" class="loading" style="display: none;">Carregando dados...</div>
		<div id="error" class="error" style="display: none;"></div>
        
		<table>
			<thead>
				<tr>
					<th>Dom</th>
					<th>Seg</th>
					<th>Ter</th>
					<th>Qua</th>
					<th>Qui</th>
					<th>Sex</th>
					<th>SÃ¡b</th>
				</tr>
			</thead>
			<tbody id="calendar-body">
			</tbody>
		</table>
		<!-- Modal para adicionar escala -->
		<div id="scheduleModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h2>Editar Folgas</h2>
					<span class="close">&times;</span>
				</div>
				<!-- Primeira etapa: SeleÃ§Ã£o de dados -->
				<div id="step1" class="modal-step">
					<div class="form-group">
						<label>Selecione a pessoa:</label>
						<div class="person-selection">
							<div class="person-option">
								<input type="radio" id="cris" name="pessoa" value="Cris">
								<label for="cris">Cris</label>
							</div>
							<div class="person-option">
								<input type="radio" id="clei" name="pessoa" value="Clei">
								<label for="clei">Clei</label>
							</div>
						</div>
					</div>
					<div class="form-group">
						<label>PerÃ­odo da escala:</label>
						<div class="date-selection">
							<select id="schedule-month">
								<option value="">Selecione o mÃªs</option>
							</select>
							<select id="schedule-year">
								<option value="">Selecione o ano</option>
							</select>
						</div>
						<div class="toggle-input-link">
						  <a href="#" id="delete-schedule-link" style="color: #dc3545;">Excluir escala</a>
						</div>
					</div>
					<div class="modal-buttons">
						<button class="btn-secondary" id="cancel-btn">Cancelar</button>
						<button class="btn-primary" id="next-btn">AvanÃ§ar</button>
					</div>
				</div>
				<!-- Segunda etapa: Input das folgas -->
				<div id="step2" class="modal-step" style="display: none;">
					<!-- SeÃ§Ã£o do calendÃ¡rio (visÃ­vel por padrÃ£o) -->
					<div id="calendar-section">
						<div class="form-group">
							<label>Marque os dias de folga no calendÃ¡rio:</label>
							<div class="editable-calendar">
								<table>
									<thead>
										<tr>
											<th>Dom</th>
											<th>Seg</th>
											<th>Ter</th>
											<th>Qua</th>
											<th>Qui</th>
											<th>Sex</th>
											<th>SÃ¡b</th>
										</tr>
									</thead>
									<tbody id="editable-calendar-body">
									</tbody>
								</table>
							</div>
						</div>
						<div class="toggle-input-link">
							<a href="#" id="show-table-input">Prefere colar tabela HTML?</a>
						</div>
					</div>
					<!-- SeÃ§Ã£o do textarea (oculta por padrÃ£o) -->
					<div id="table-input-section" style="display: none;">
						<div class="form-group">
							<label for="schedule-table">Cole a tabela HTML da escala ou sequÃªncia separada por ",":</label>
							<textarea id="schedule-table" placeholder="<table><tbody><tr><td... ou 14, 15,"></textarea>
						</div>
						<div class="toggle-input-link">
							<a href="#" id="show-calendar">Prefere usar o calendÃ¡rio?</a>
						</div>
					</div>
					<div class="modal-buttons">
						<button class="btn-secondary" id="back-btn">Voltar</button>
						<button class="btn-primary" id="save-schedule-btn">Salvar Escala</button>
					</div>
				</div>
			</div>
		</div>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@18.2.0"></script>
<script>
// ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚
// Bloco AppWrite | Inicio
// ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚
let databases, Query, ID, client;

function initAppwrite() {
  return new Promise((resolve, reject) => {
    // Se jÃ¡ inicializou, resolve imediatamente
    if (client) {
      resolve();
      return;
    }
    
    // Verifica se Appwrite estÃ¡ disponÃ­vel
    if (typeof Appwrite !== 'undefined') {
      try {
        client = new Appwrite.Client()
          .setEndpoint('https://nyc.cloud.appwrite.io/v1')
          .setProject('686a67d5003a1b4b1bf9');
        
        databases = new Appwrite.Databases(client);
        Query = Appwrite.Query;
        ID = Appwrite.ID;
        resolve();
      } catch (error) {
        reject(error);
      }
    } else {
      // Se Appwrite nÃ£o estÃ¡ carregado, aguarda um pouco e tenta novamente
      setTimeout(() => {
        initAppwrite().then(resolve).catch(reject);
      }, 1000);
    }
  });
}

async function saveScheduleAppwrite(pessoa, ano, mes, folgas) {
  try {
    // Garante que a inicializaÃ§Ã£o ocorreu antes de usar as variÃ¡veis.
    await initAppwrite();

    const DATABASE_ID = '686a68130002b51fced0';
    const COLLECTION_ID = '68c535f2001de9505bde';
    
    // Converte o nÃºmero do mÃªs para nome do mÃªs
    const meses = [
      'janeiro', 'fevereiro', 'marÃ§o', 'abril', 'maio', 'junho',
      'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'
    ];
    const nomeDoMes = meses[parseInt(mes) - 1];
    
    const response = await databases.listDocuments(DATABASE_ID, COLLECTION_ID, [
      Query.equal('people', pessoa),
      Query.equal('year', parseInt(ano)),
      Query.equal('month', nomeDoMes)
    ]);

    const dadosParaSalvar = {
      people: pessoa,
      year: parseInt(ano),
      month: nomeDoMes,
      daysOff: folgas.map(dia => parseInt(dia))
    };

    if (response.documents.length > 0) {
      const documentId = response.documents[0].$id;
      await databases.updateDocument(DATABASE_ID, COLLECTION_ID, documentId, dadosParaSalvar);
    } else {
      await databases.createDocument(DATABASE_ID, COLLECTION_ID, ID.unique(), dadosParaSalvar);
    }
  } catch (error) {
    console.error('Erro ao salvar no Appwrite:', error);
    alert('Erro ao salvar escala: ' + error.message);
    throw error;
  }
}

// ====================
// Gerar Lista de Meses
// ====================
async function loadAvailableMonthsYears() {
  try {
    await initAppwrite();

    const DATABASE_ID = '686a68130002b51fced0';
    const COLLECTION_ID = '68c535f2001de9505bde';

    const response = await databases.listDocuments(DATABASE_ID, COLLECTION_ID);

    const mesAnoSet = new Set();

    const capitalize = s => s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();

    response.documents.forEach(doc => {
      if (doc.month && doc.year) {
        const mesCapitalizado = capitalize(doc.month);
        mesAnoSet.add(`${mesCapitalizado}-${doc.year}`);
      }
    });

    const mesesLista = [
      'Janeiro', 'Fevereiro', 'MarÃ§o', 'Abril', 'Maio', 'Junho',
      'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
    ];

    const mesAnoArray = Array.from(mesAnoSet).map(item => {
      const [mesNome, ano] = item.split('-');
      const mesIndex = mesesLista.findIndex(m => m === mesNome) + 1;
      return { mesNome, ano: parseInt(ano), mesIndex };
    });

    mesAnoArray.sort((a, b) => {
      if (a.ano === b.ano) return a.mesIndex - b.mesIndex;
      return a.ano - b.ano;
    });

    const monthSelect = document.getElementById('month-select');
    monthSelect.innerHTML = '';

    mesAnoArray.forEach(({ mesNome, ano, mesIndex }) => {
      const option = document.createElement('option');
      option.value = `${ano}-${mesIndex.toString().padStart(2, '0')}`;
      option.textContent = `${mesNome} / ${ano}`;
      monthSelect.appendChild(option);
    });

    if (mesAnoArray.length === 0) {
      const option = new Option('Nenhum mÃªs carregado', '');
      monthSelect.appendChild(option);
    } else {
      // NOVO: Selecionar automaticamente o mÃªs atual ou o mais prÃ³ximo
      const dataAtual = new Date();
      const mesAtual = dataAtual.getMonth() + 1;
      const anoAtual = dataAtual.getFullYear();
      
      // Procura o mÃªs atual primeiro
      let opcaoParaSelecionar = mesAnoArray.find(item => 
        item.mesIndex === mesAtual && item.ano === anoAtual
      );
      
      // Se nÃ£o encontrar o mÃªs atual, pega o primeiro disponÃ­vel
      if (!opcaoParaSelecionar) {
        opcaoParaSelecionar = mesAnoArray[0];
      }
      
      // Define o valor selecionado
      const valorParaSelecionar = `${opcaoParaSelecionar.ano}-${opcaoParaSelecionar.mesIndex.toString().padStart(2, '0')}`;
      monthSelect.value = valorParaSelecionar;
      
      // ConstrÃ³i o calendÃ¡rio automaticamente
      buildCalendar(opcaoParaSelecionar.ano, opcaoParaSelecionar.mesIndex);
    }
  } catch (error) {
    console.error('Erro ao carregar meses e anos disponÃ­veis:', error);
    
    // Fallback - criar opÃ§Ã£o padrÃ£o quando hÃ¡ erro de conexÃ£o
    const monthSelect = document.getElementById('month-select');
    monthSelect.innerHTML = '';
    const option = new Option('Erro ao carregar - verifique conexÃ£o', '');
    monthSelect.appendChild(option);
    
    // NÃ£o exibir alert para nÃ£o interromper a experiÃªncia do usuÃ¡rio
    console.warn('Falha na conexÃ£o com Appwrite. Verifique sua internet e configuraÃ§Ãµes do projeto.');
  }
}

loadAvailableMonthsYears();

// ====================
// Construir Calendario
// ====================

// Ouvinte de evento ao select para disparar a atualizaÃ§Ã£o do calendÃ¡rio
document.getElementById('month-select').addEventListener('change', handleMonthSelectChange);

function handleMonthSelectChange() {
  const monthSelect = document.getElementById('month-select');
  const selectedValue = monthSelect.value; // Exemplo: "2025-09"
  if (!selectedValue) return; // Nada selecionado

  // Divide o valor "YYYY-MM" para ano e mÃªs
  const [yearStr, monthStr] = selectedValue.split('-');
  const year = parseInt(yearStr);
  const month = parseInt(monthStr);

  // Chama funÃ§Ã£o buildCalendar existente para montar o calendÃ¡rio
  buildCalendar(year, month);
}

// ====================
// Combinar Escalas
// ====================
async function buildCalendar(year, month) {
  const calendarBody = document.getElementById('calendar-body');
  if (!calendarBody) {
    console.error("Elemento 'calendar-body' nÃ£o encontrado!");
    return;
  }

  calendarBody.innerHTML = '';
  const firstDayOfMonth = new Date(year, month - 1, 1);
  const lastDayOfMonth = new Date(year, month, 0);
  const daysInMonth = lastDayOfMonth.getDate();
  const startDayOfWeek = firstDayOfMonth.getDay();
  
  // Definir os nomes dos meses diretamente
  const mesesNomes = [
    'janeiro', 'fevereiro', 'marÃ§o', 'abril', 'maio', 'junho',
    'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'
  ];
  
  // Capitalizar primeira letra do mÃªs para manter consistÃªncia
  const mesCapitalizado = mesesNomes[month - 1].charAt(0).toUpperCase() + mesesNomes[month - 1].slice(1);
  const monthKey = `${mesCapitalizado} ${year}`;

  // Carregar dados das folgas do Appwrite e montar objeto schedules
  let schedules = {};
  let people = []; // Array dinÃ¢mico baseado nos dados do banco
  
  try {
    await initAppwrite();
    const DATABASE_ID = '686a68130002b51fced0';
    const COLLECTION_ID = '68c535f2001de9505bde';
    
    const response = await databases.listDocuments(DATABASE_ID, COLLECTION_ID, [
      Query.equal('year', year),
      Query.equal('month', mesesNomes[month - 1])
    ]);
    
    console.log('Dados carregados do Appwrite:', response.documents);
    
    // Montar o objeto schedules e array people dinamicamente
    response.documents.forEach(doc => {
      if (!people.includes(doc.people)) {
        people.push(doc.people); // Adiciona a pessoa ao array se nÃ£o existir
      }
      
      if (!schedules[doc.people]) {
        schedules[doc.people] = {};
      }
      schedules[doc.people][monthKey] = doc.daysOff || [];
      console.log(`Folgas para ${doc.people} em ${monthKey}:`, doc.daysOff);
    });
    
    console.log('Pessoas encontradas:', people);
    console.log('Objeto schedules montado:', schedules);
    console.log('monthKey usado:', monthKey);
    
  } catch (error) {
    console.error('Erro ao carregar dados das folgas:', error);
  }

  let date = 1;

  for (let week = 0; week < 6; week++) {
    const row = document.createElement('tr');

    for (let dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++) {
      const cell = document.createElement('td');

      if (week === 0 && dayOfWeek < startDayOfWeek) {
        cell.classList.add('empty');
      } else if (date > daysInMonth) {
        cell.classList.add('empty');
      } else {
        let cellContent = `<div class="day-title">${date}</div>`;
        
        people.forEach(person => {
          let status = '';
          let className = 'workday';

          if (schedules[person] && schedules[person][monthKey]) {
            const dayOffList = schedules[person][monthKey];
            
            // Garantir que tanto date quanto os valores da lista sejam do mesmo tipo
            if (dayOffList.includes(parseInt(date)) || dayOffList.includes(date.toString())) {
              status = '';
              className = person.toLowerCase().replace(' ', '-') + '-day-off';
              cellContent += `<div class="${className}"><span class="person-name">${person}</span> ${status}</div>`;
              console.log(`Folga encontrada: ${person} no dia ${date}`);
            }
          }
        });

        cell.innerHTML = cellContent;
        date++;
      }

      row.appendChild(cell);
    }

    calendarBody.appendChild(row);

    if (date > daysInMonth) {
      break;
    }
  }
}

// ====================
// Excluir Escalas
// ====================
async function deleteScheduleAppwrite(pessoa, ano, mes) {
  try {
    await initAppwrite();

    const DATABASE_ID = '686a68130002b51fced0';
    const COLLECTION_ID = '68c535f2001de9505bde';
    
    // Converte o nÃºmero do mÃªs para nome do mÃªs
    const meses = [
      'janeiro', 'fevereiro', 'marÃ§o', 'abril', 'maio', 'junho',
      'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'
    ];
    const nomeDoMes = meses[parseInt(mes) - 1];
    
    const response = await databases.listDocuments(DATABASE_ID, COLLECTION_ID, [
      Query.equal('people', pessoa),
      Query.equal('year', parseInt(ano)),
      Query.equal('month', nomeDoMes)
    ]);

    if (response.documents.length > 0) {
      const documentId = response.documents[0].$id;
      await databases.deleteDocument(DATABASE_ID, COLLECTION_ID, documentId);
      console.log('Escala excluÃ­da com sucesso!');
    } else {
      throw new Error('Escala nÃ£o encontrada para exclusÃ£o.');
    }
  } catch (error) {
    console.error('Erro ao excluir no Appwrite:', error);
    throw error;
  }
}
// ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚
// Bloco AppWrite | Fim
// ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚

const FolgasEditor = (() => {
  // Estado interno da ediÃ§Ã£o
  let state = {
    isModalOpen: false,
    pessoaSelecionada: null,
    mesSelecionado: null,
    anoSelecionado: null,
    folgasSelecionadas: new Set(),
  };
//

  // Cache de elementos DOM
  const elements = {
    modal: document.getElementById('scheduleModal'),
    closeBtn: document.querySelector('#scheduleModal .close'),
    nextBtn: document.getElementById('next-btn'),
    cancelBtn: document.getElementById('cancel-btn'),
    backBtn: document.getElementById('back-btn'),
    saveBtn: document.getElementById('save-schedule-btn'),
    pessoaRadios: document.querySelectorAll('input[name="pessoa"]'),
    monthSelect: document.getElementById('schedule-month'),
    yearSelect: document.getElementById('schedule-year'),
    editableCalendarBody: document.getElementById('editable-calendar-body'),
    step1: document.getElementById('step1'),
    step2: document.getElementById('step2'),
    deleteLink: document.getElementById('delete-schedule-link'),
    // Outras referÃªncias conforme necessÃ¡rio
  };

  // FunÃ§Ã£o para abrir modal com inicializaÃ§Ã£o
  function openModal() {
    loadSelectOptions();
    clearState();

    // NOVO: Capturar mÃªs e ano atualmente visualizados
    const monthSelect = document.getElementById('month-select');
    if (monthSelect.value) {
      const [yearStr, monthStr] = monthSelect.value.split('-');
      const year = parseInt(yearStr);
      const month = parseInt(monthStr);

      // PrÃ©-selecionar no modal
      elements.monthSelect.value = month;
      elements.yearSelect.value = year;

      // Atualizar o estado interno
      state.mesSelecionado = month.toString();
      state.anoSelecionado = year.toString();
    }

    renderStep1();
    elements.modal.style.display = 'block';
    state.isModalOpen = true;
    attachListeners();
    updateDeleteLinkText();
  }

  // FunÃ§Ã£o para fechar modal e limpar listeners
  function closeModal() {
    elements.modal.style.display = 'none';
    state.isModalOpen = false;
    detachListeners();
  }

  // Limpa o estado antes de nova ediÃ§Ã£o
  function clearState() {
    state.pessoaSelecionada = null;
    state.mesSelecionado = null;
    state.anoSelecionado = null;
    state.folgasSelecionadas.clear();
    // Reset apenas os radio buttons, nÃ£o os selects (serÃ£o definidos no openModal)
    elements.pessoaRadios.forEach(radio => radio.checked = false);
    // NÃƒO limpar os selects aqui - serÃ¡ feito no openModal()
    // elements.monthSelect.value = '';
    // elements.yearSelect.value = '';
  }

  // Inicializa opÃ§Ãµes dos selects mÃªs e ano (exemplo)
  function loadSelectOptions() {
    // Aqui pode-se carregar meses e anos dinamicamente conforme necessidade
    // Exemplo simples:
    if (elements.monthSelect.options.length <= 1) {
      const meses = [
        'Janeiro', 'Fevereiro', 'MarÃ§o', 'Abril', 'Maio', 'Junho',
        'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
      ];
      meses.forEach((mes, i) => {
        const option = new Option(mes, i + 1);
        elements.monthSelect.add(option);
      });
    }
    if (elements.yearSelect.options.length <= 1) {
      const anoAtual = new Date().getFullYear();
      for (let ano = anoAtual - 5; ano <= anoAtual + 5; ano++) {
        const option = new Option(ano, ano);
        elements.yearSelect.add(option);
      }
    }
  }

  // FunÃ§Ã£o para atualizar o texto do link de exclusÃ£o
  function updateDeleteLinkText() {
    const deleteLink = document.getElementById('delete-schedule-link');
    const selectedMonth = document.getElementById('schedule-month').value;
    const selectedYear = document.getElementById('schedule-year').value;

    if (deleteLink && selectedMonth && selectedYear) {
      // Converter nÃºmero do mÃªs para nome
      const meses = [
        'Janeiro', 'Fevereiro', 'MarÃ§o', 'Abril', 'Maio', 'Junho',
        'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
      ];
      const nomeDoMes = meses[parseInt(selectedMonth) - 1];
      deleteLink.textContent = `Excluir escala de ${nomeDoMes} de ${selectedYear}?`;
    } else {
      if (deleteLink) {
        deleteLink.textContent = 'Excluir escala';
      }
    }
  }
  
  // FunÃ§Ã£o para tratar a exclusÃ£o da escala
  async function handleDeleteSchedule(event) {
    event.preventDefault();

    // CORRIGIDO: Capturar os valores diretamente dos elementos DOM
    const pessoaSelecionada = Array.from(elements.pessoaRadios).find(r => r.checked)?.value || null;
    const mesSelecionado = elements.monthSelect.value || null;
    const anoSelecionado = elements.yearSelect.value || null;

    if (!pessoaSelecionada || !mesSelecionado || !anoSelecionado) {
      alert('Por favor, selecione pessoa, mÃªs e ano primeiro.');
      return;
    }

    const meses = [
      'Janeiro', 'Fevereiro', 'MarÃ§o', 'Abril', 'Maio', 'Junho',
      'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
    ];
    const nomeDoMes = meses[parseInt(mesSelecionado) - 1];

    const confirmacao = confirm("Tem certeza que deseja excluir a escala de " + pessoaSelecionada + " para " + nomeDoMes + " de " + anoSelecionado + "?");

    if (confirmacao) {
      try {
        await deleteScheduleAppwrite(pessoaSelecionada, anoSelecionado, mesSelecionado);
        alert('Escala excluÃ­da com sucesso!');
        closeModal();

        // Recarregar a lista de meses disponÃ­veis
        await loadAvailableMonthsYears();

      } catch (error) {
        console.error('Erro ao excluir escala:', error);
		alert("Erro ao excluir escala: " + error.message);      }
    }
  }

  // Renderiza primeira etapa (seleÃ§Ã£o)
  function renderStep1() {
    elements.step1.style.display = 'block';
    elements.step2.style.display = 'none';
  }

  // Renderiza segunda etapa (calendÃ¡rio ou textarea)
  function renderStep2() {
    elements.step1.style.display = 'none';
    elements.step2.style.display = 'block';
    renderEditableCalendar();
  }

  // Exemplo simples para montar calendÃ¡rio editÃ¡vel
  async function renderEditableCalendar() {
    const mes = Number(elements.monthSelect.value);
    const ano = Number(elements.yearSelect.value);

    if (!mes || !ano) {
      console.error('MÃªs ou ano nÃ£o selecionado');
      return;
    }

    try {
      // Limpa calendÃ¡rio atual
      elements.editableCalendarBody.innerHTML = '';

      // Limpa seleÃ§Ãµes anteriores
      state.folgasSelecionadas.clear();

      // NOVO: Carregar dados existentes do Appwrite
      let folgasExistentes = [];
      if (state.pessoaSelecionada) {
        try {
          await initAppwrite();
          const DATABASE_ID = '686a68130002b51fced0';
          const COLLECTION_ID = '68c535f2001de9505bde';

          const mesesNomes = [
            'janeiro', 'fevereiro', 'marÃ§o', 'abril', 'maio', 'junho',
            'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'
          ];

          const response = await databases.listDocuments(DATABASE_ID, COLLECTION_ID, [
            Query.equal('people', state.pessoaSelecionada),
            Query.equal('year', parseInt(ano)),
            Query.equal('month', mesesNomes[mes - 1])
          ]);

          if (response.documents.length > 0) {
            folgasExistentes = response.documents[0].daysOff || [];
            console.log('Folgas existentes carregadas:', folgasExistentes);
          }
        } catch (error) {
          console.error('Erro ao carregar folgas existentes:', error);
        }
      }

      // Obter nÃºmero de dias no mÃªs
      const diasNoMes = new Date(ano, mes, 0).getDate();
      const primeiroDia = new Date(ano, mes - 1, 1);
      const diaDaSemanaInicial = primeiroDia.getDay();

      // Gerar linhas e cÃ©lulas para cada dia
      let diaAtual = 1;
      let semanaAtual = 0;

      // Criar semanas atÃ© cobrir todos os dias
      while (diaAtual <= diasNoMes) {
        const row = document.createElement('tr');

        for (let diaDaSemana = 0; diaDaSemana < 7; diaDaSemana++) {
          const cell = document.createElement('td');

          // Primeira semana - cÃ©lulas vazias antes do primeiro dia
          if (semanaAtual === 0 && diaDaSemana < diaDaSemanaInicial) {
            cell.classList.add('empty');
          }
          // Dias do mÃªs
          else if (diaAtual <= diasNoMes) {
            const label = document.createElement('label');
            label.classList.add('day-checkbox');

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = diaAtual;
            checkbox.id = 'day-' + diaAtual;

            // AJUSTADO: Verificar se o dia estÃ¡ nas folgas existentes
            const diaNumero = parseInt(diaAtual);
            const estaNoAppwrite = folgasExistentes.includes(diaNumero);
            checkbox.checked = estaNoAppwrite;

            // Se estÃ¡ marcado no Appwrite, adicionar ao estado
            if (estaNoAppwrite) {
              state.folgasSelecionadas.add(diaNumero);
            }

            // Event listener para mudanÃ§as no checkbox
            checkbox.addEventListener('change', (event) => {
              const dia = parseInt(event.target.value);

              if (event.target.checked) {
                state.folgasSelecionadas.add(dia);
                console.log('Dia ' + dia + ' adicionado. Folgas atuais:', Array.from(state.folgasSelecionadas));
              } else {
                state.folgasSelecionadas.delete(dia);
                console.log('Dia ' + dia + ' removido. Folgas atuais:', Array.from(state.folgasSelecionadas));
              }
            });

            const labelText = document.createTextNode(diaAtual);

            label.appendChild(checkbox);
            label.appendChild(labelText);
            cell.appendChild(label);

            diaAtual++;
          }
          // CÃ©lulas vazias apÃ³s o Ãºltimo dia
          else {
            cell.classList.add('empty');
          }

          row.appendChild(cell);
        }

        elements.editableCalendarBody.appendChild(row);
        semanaAtual++;

        // Evita loop infinito
        if (semanaAtual > 6) break;
      }

      console.log('CalendÃ¡rio editÃ¡vel criado para', mes, '/', ano);
      console.log('Folgas prÃ©-selecionadas:', Array.from(state.folgasSelecionadas));

    } catch (error) {
      console.error('Erro ao criar calendÃ¡rio editÃ¡vel:', error);
      alert('Erro ao criar calendÃ¡rio: ' + error.message);
    }
  }

  // ValidaÃ§Ã£o de seleÃ§Ã£o da primeira etapa
  function validateStep1() {
    state.pessoaSelecionada = Array.from(elements.pessoaRadios).find(r => r.checked)?.value || null;
    state.mesSelecionado = elements.monthSelect.value || null;
    state.anoSelecionado = elements.yearSelect.value || null;

    if (!state.pessoaSelecionada) {
      alert('Por favor, selecione a pessoa.');
      return false;
    }
    if (!state.mesSelecionado) {
      alert('Por favor, selecione o mÃªs.');
      return false;
    }
    if (!state.anoSelecionado) {
      alert('Por favor, selecione o ano.');
      return false;
    }
    return true;
  }

  // FunÃ§Ãµes de callback para os eventos
  const handleNext = () => {
    if (validateStep1()) {
      renderStep2();
    }
  };

  // Attach global listeners durante modal aberta
  function attachListeners() {
    elements.closeBtn.addEventListener('click', closeModal);
    elements.cancelBtn.addEventListener('click', closeModal);
    elements.nextBtn.addEventListener('click', handleNext);
    elements.backBtn.addEventListener('click', renderStep1);
    elements.saveBtn.addEventListener('click', saveSchedule);
  
    // NOVO: Adicionar listeners para atualizar o texto do link de exclusÃ£o
    elements.monthSelect.addEventListener('change', updateDeleteLinkText);
    elements.yearSelect.addEventListener('change', updateDeleteLinkText);
    
    elements.deleteLink.addEventListener('click', handleDeleteSchedule);

  }

  // Remove listeners para evitar duplicaÃ§Ã£o
  function detachListeners() {
    elements.closeBtn.removeEventListener('click', closeModal);
    elements.cancelBtn.removeEventListener('click', closeModal);
    elements.nextBtn.removeEventListener('click', handleNext);
    elements.backBtn.removeEventListener('click', renderStep1);
    elements.saveBtn.removeEventListener('click', saveSchedule);
    
    // NOVO: Remover listeners do texto do link de exclusÃ£o
    elements.monthSelect.removeEventListener('change', updateDeleteLinkText);
    elements.yearSelect.removeEventListener('change', updateDeleteLinkText);
    
    elements.deleteLink.removeEventListener('click', handleDeleteSchedule);

  }

  // SimulaÃ§Ã£o de salvar a escala
  async function saveSchedule() {
    if (state.folgasSelecionadas.size === 0) {
      alert('Por favor, selecione pelo menos um dia de folga.');
      return Promise.reject('Nenhum dia selecionado');
    }
  
    const pessoa = state.pessoaSelecionada;
    const mes = state.mesSelecionado;
    const ano = state.anoSelecionado;
    
    if (!pessoa || !mes || !ano) {
      alert('Dados incompletos. Verifique pessoa, mÃªs e ano.');
      return Promise.reject('Dados incompletos');
    }
  
    try {
      // Converte Set para Array de nÃºmeros ordenados
      const folgas = Array.from(state.folgasSelecionadas).sort((a, b) => a - b);
      
      console.log('Salvando escala para:', { pessoa, mes, ano, folgas });
      console.log('Tipo dos dados das folgas:', folgas.map(f => typeof f));
  
      await saveScheduleAppwrite(pessoa, ano, mes, folgas);
      
      console.log('Escala salva com sucesso!');
      alert('Escala salva com sucesso!');
      
      closeModal();
      
      // Recarregar o calendÃ¡rio para mostrar as mudanÃ§as
      const monthSelect = document.getElementById('month-select');
      if (monthSelect.value) {
        const [yearStr, monthStr] = monthSelect.value.split('-');
        buildCalendar(parseInt(yearStr), parseInt(monthStr));
      }
      
      return Promise.resolve();
  
    } catch (error) {
      console.error('Erro ao salvar escala:', error);
	  alert('Erro ao salvar escala: ' + error.message);      throw error;
    }
  }
  return {
    openModal,
  };
})();

// Para abrir a ediÃ§Ã£o de folgas
document.getElementById('add-schedule-btn').addEventListener('click', () => {
  FolgasEditor.openModal();
});
    </script>
    
<script type="module">
// ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚
// Bloco Token | Inicio
// ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚ð’…‚
        // FunÃ§Ã£o para ocultar todos os elementos principais da pÃ¡gina
        function hideMainContent() {
          // Ocultar elementos principais
          document.querySelector('h2').style.display = 'none';
          document.querySelector('.notification').style.display = 'none';
          document.querySelector('.controls').style.display = 'none';
          document.querySelector('table').style.display = 'none';
          document.getElementById('scheduleModal').style.display = 'none';

          // Ocultar divs de loading e error se existirem
          const loading = document.getElementById('loading');
          const error = document.getElementById('error');
          if (loading) loading.style.display = 'none';
          if (error) error.style.display = 'none';
        }

        // FunÃ§Ã£o para mostrar o conteÃºdo principal
        function showMainContent() {
          document.getElementById('accessModal').style.display = 'none';
          document.querySelector('h1').style.display = 'block';
          document.querySelector('.notification').style.display = 'flex';
          document.querySelector('.controls').style.display = 'block';
          document.querySelector('table').style.display = 'table';
        }
        hideMainContent();
        
        import { Client, Functions } from 'https://cdn.jsdelivr.net/npm/appwrite@20.0.0/dist/esm/sdk.js';

        // Substitua com as suas credenciais do Appwrite
        const client = new Client()
            .setEndpoint('https://nyc.cloud.appwrite.io/v1')
            .setProject('686a67d5003a1b4b1bf9');

        const functions = new Functions(client);

        const tokenInput = document.getElementById('tokenInput');
        const accessButton = document.getElementById('accessButton');
        const statusMessage = document.getElementById('statusMessage');

        // Adiciona um "ouvinte" ao botÃ£o
        accessButton.addEventListener('click', async () => {
            const token = tokenInput.value;

            if (!token) {
                statusMessage.textContent = 'Por favor, digite o token.';
                statusMessage.style.color = '#e74c3c';
                return;
            }
            
            statusMessage.textContent = 'Verificando token...';
            statusMessage.style.color = '#f1c40f';

            try {
                const response = await functions.createExecution(
                    '68c5be1b00315ff07f89',
                    JSON.stringify({ token: token })
                );

                // ADICIONE ESTAS LINHAS PARA DEBUG:
                console.log('Response completa:', response);
                console.log('Response.body:', response.body);
                console.log('Response.responseBody:', response.responseBody);

                // Tente usar responseBody em vez de body:
                const result = JSON.parse(response.responseBody || response.body || '{}');

                if (result.success) {
                    statusMessage.textContent = 'Token correto! Acesso liberado.';
                    statusMessage.style.color = '#2ecc71';
                          setTimeout(() => {
                            showMainContent();
                          }, 1000);
                } else {
                    statusMessage.textContent = 'Token invÃ¡lido. Tente novamente.';
                    statusMessage.style.color = '#e74c3c';
                }
            } catch (error) {
                console.error('Erro ao chamar a funÃ§Ã£o:', error);
                statusMessage.textContent = 'Erro de comunicaÃ§Ã£o. Tente mais tarde.';
                statusMessage.style.color = '#e74c3c';
            }
        });
    </script>
  </body>
</html>
