<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Escala de Folgas - Mês Completo</title>
		<style>
			body {
			font-family: Arial, sans-serif;
			margin: 20px;
			}
			h1 {
			text-align: center;
			margin-bottom: 20px;
			}
            
        	/*clamp(valor mínimo, valor ideal, valor máximo)*/
			/**/
			.computer-mode {
			width: 1000px;
			margin: 0 auto;
			font-size: 16px;
			}
			.switch {
			position: relative;
			display: inline-block;
			width: 45px;
			height: 25px;
			}
			.switch input {
			opacity: 0;
			width: 0;
			height: 0;
			}
			.slider {
			position: absolute;
			cursor: pointer;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: #ccc;
			transition: 0.4s;
			}
			.slider:before {
			position: absolute;
			content: "";
			height: 19px; /* Ajuste o height da bolinha para ser um pouco menor que o switch */
			width: 19px; /* Ajuste o width da bolinha para ser igual ao height */
			left: 3px; /* Ajuste a posição esquerda da bolinha */
			bottom: 3px; /* Ajuste a posição inferior da bolinha */
			background-color: white;
			transition: 0.4s;
			}
			input:not(:checked) + .slider {
			background-color: #1abc9c; /* Cor do switch desligado */
			}
			input:checked + .slider {
			background-color: #2196F3;
			}
			input:focus + .slider {
			box-shadow: 0 0 1px #2196F3;
			}
			input:checked + .slider:before {
			transform: translateX(20px);
			}
			.slider.round {
			border-radius: 20px;
			}
			.slider.round:before {
			border-radius: 50%;
			}
			.mode-container {
			display: flex;
			align-items: center;
			}
			.mode-status {
			margin-left: 10px;
			font-size: 16px;
			}
			/**/
			.token {
			text-align: center;
			margin-bottom: 20px;
			}
			.token button {
			padding: 15px 30px;
			background-color: #007bff;
			color: white;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.3s ease;
			font-weight: 600;
			font-size: 20px;
			min-width: 120px;
			}	  
			.token button:hover {
			background-color: #0056b3;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
			}
			.token input {
			text-align: center;
			width: 700px;
			max-width: 90%;
			height: 50px;
			margin-bottom: 15px; /* Adiciona um espaço entre o input e o botão */
			}
            
      /**/  
      .notification {
			    position: fixed;
			    top: 15px; /* Valor fixo para garantir que fique no topo */
			    right: 15px; /* Valor fixo para garantir que fique na direita */
			    cursor: pointer;
			    z-index: 9999; /* Garante que fique acima de outros elementos */
			    width: clamp(45px, 10vw, 70px);
			    height: clamp(45px, 10vw, 70px); /* Mantém quadrado */
			    display: flex;
			    align-items: center;
			    justify-content: center;
			    /* position: relative; foi removido pois 'position: fixed' já estabelece o contexto de posicionamento para filhos com 'position: absolute' */
			}
			.notification img {
			    width: 100%;
			    height: auto;
			    aspect-ratio: 1 / 1;
			    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.5));
			}
			.notification .counter {
			    position: absolute;
			    /* Ajuste de posição RELATIVA à .notification */
			    top: -5%;
			    right: -5%; /* O counter continua no canto superior direito do ícone */
			    background-color: 
			    color: #fff;
			    filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.5));
			    border-radius: 50%;
                
          display: flex;
			    padding: 5%; /* relativo ao width do pai */
			    width: 40%;
			    height: 40%;
			}		
      
      .notification .counter img {
          width: 100%;
          height: 100%;
          filter: none;
      }
			/**/   
			.controls {
			text-align: center;
			margin-bottom: 20px;
			}
			.controls select {
			padding: 12px 16px;
			margin-right: 10px;
			border: 2px solid #e0e0e0;
			border-radius: 8px;
			background-color: white;
			font-size: 16px;
			font-weight: 500;
			transition: all 0.3s ease;
			min-width: 180px;
			margin-bottom: 15px; /* Adiciona um espaço entre o input e o botão */
			}
			.controls select:focus {
			border-color: #007bff;
			outline: none;
			box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
			}
			.controls button {
			padding: 12px 25px;
			background-color: #007bff;
			color: white;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.3s ease;
			font-weight: 600;
			font-size: 20px;
			min-width: 140px;
			}
			.controls button:hover {
			background-color: #0056b3;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
			}
			/* Modal styles */
			.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.5);
			}
			.modal-content {
			background-color: white;
			margin: 1% auto;
			padding: 20px;
			border-radius: 8px;
			width: 90%;
			max-width: 750px; /* Remova o limite de largura máximo */
			max-height: 95vh;
			overflow-y: auto;
			}
			.modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
			border-bottom: 1px solid #eee;
			padding-bottom: 10px;
			}
			.close {
			color: #aaa;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
			}
			.close:hover {
			color: #000;
			}
			.form-group {
			margin-bottom: 15px;
			}
			.form-group label {
			display: block;
			margin-bottom: 5px;
			}
			.person-selection label, .date-selection label {
			font-weight: bold;
			font-size: 18px; /* Aumente o tamanho da fonte */
			}
			#scheduleModal label {
			font-size: 30px; /* Aumente o tamanho da fonte */
			}
			.form-group input, .form-group select, .form-group textarea {
			width: 100%;
			padding: 12px; /* Aumente o espaçamento interno */
			border: 1px solid #ccc;
			border-radius: 4px;
			box-sizing: border-box;
			font-size: 20px; /* Aumente o tamanho da fonte */
			}
			.form-group textarea {
			height: 150px;
			resize: vertical;
			}
			.person-selection {
			display: flex;
			gap: 20px;
			margin-bottom: 15px;
			}
			.person-option {
			display: flex;
			align-items: center; /* Garante alinhamento vertical */
			gap: 8px;
			}
			.person-option input[type="radio"] {
			width: 20px; /* 25px pode ser grande demais para alinhar com texto */
			height: 20px;
			margin: 0;
			vertical-align: middle; /* importante */
			}
			.date-selection {
			display: flex;
			gap: 10px;
			margin-bottom: 15px;
			}
			.date-selection select {
			flex: 1;
			}
			.modal-buttons button {
			padding: 15px 30px;
			margin-right: 30px;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-size: 20px;
			transition: all 0.3s ease;
			font-weight: 600;
			min-width: 120px;
			margin-bottom: 15px; /* Adiciona um espaço entre o input e o botão */
			}
			.modal-step {
			min-height: 200px;
			}
			.modal-step.hidden {
			display: none !important;
			}
			.btn-primary {
			background-color: #007bff;
			color: white;
			}
			.btn-primary:hover {
			background-color: #0056b3;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
			}
			.btn-secondary {
			background-color: #6c757d;
			color: white;
			}
			.btn-secondary:hover {
			background-color: #5a6268;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
			}
			.editable-calendar {
			margin: 20px 0;
			}
			.editable-calendar table {
			width: 100%;
			max-width: 500px;
			margin: 0 auto;
			}
			.day-checkbox {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 5px;
			}
			.day-checkbox input[type="checkbox"] {
			width: 18px;
			height: 18px;
			margin: 0;
			}
			.day-checkbox label {
			font-size: 14px;
			cursor: pointer;
			margin: 0;
			}
			.editable-calendar td {
			padding: 10px 5px;
			text-align: center;
			}
			.editable-calendar .empty {
			background-color: #f5f5f5;
			}
			.toggle-input-link {
			text-align: right;
			margin: 15px 0;
			}
			.toggle-input-link a {
			color: #007bff;
			text-decoration: none;
			font-size: 16px;
			}
			.toggle-input-link a:hover {
			text-decoration: underline;
			color: #0056b3;
			}
			table {
			padding: 8px 4px;
			width: 850px;
			margin: auto;
			border-collapse: collapse;
			table-layout: fixed;
			}
			th, td {
			border: 1px solid #ccc;
			text-align: center;
			padding: 8px 4px;
			vertical-align: top;
			word-wrap: break-word;
			}
			th {
			background-color: #007bff;
			color: white;
			}
			.weekend {
			background-color: #d4edda; /* verde claro */
			color: #155724; /* texto verde escuro */
			}
			.workday {
			background-color: #d4edda;
			color: #155724;
			}
			.cris-day-off {
			background-color: #FFC0CB; /* rosa claro */
			}
			.clei-day-off {
			background-color: #b8daff; /* azul claro */
			}
			.person-name {
			font-weight: bold;
			}
			.loading {
			text-align: center;
			padding: 20px;
			color: #666;
			}
			.alert {
			position: relative;
			z-index: 10000;
			text-align: center;
			padding: 20px;
			border-radius: 4px;
			margin: 20px 0;
			}
			.error {
			background-color: #f8d7da;
			color: #d63384;
			border: 1px solid #f5c2c7;
			}
			.success {
			background-color: #ADD8E6;
			color: #000;
			}
			/* Estilos para popups customizados */
			#customPopup {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
			}
			.popup-content {
			background-color: white;
			margin: 50px auto 0 auto;
			padding: 20px;
			border-radius: 8px;
			width: 90%;
			max-width: 400px;
			text-align: center;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
			position: relative;
			top: 20px;
			}
			@keyframes popupSlideIn {
			from {
			opacity: 0;
			transform: translate(-50%, -60%);
			}
			to {
			opacity: 1;
			transform: translate(-50%, -50%);
			}
			}
			.popup-content.success {
			background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
			}
			.popup-content.error {
			background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
			}
			.popup-content.confirm {
			background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
			}
			.popup-icon {
			font-size: 48px;
			margin-bottom: 15px;
			display: block;
			}
			.popup-title {
			font-size: 22px;
			font-weight: bold;
			margin-bottom: 15px;
			color: white;
			}
			.popup-content.confirm .popup-title {
			color: #333;
			}
			.popup-message {
			font-size: 30px;
			line-height: 1.5;
			margin-bottom: 25px;
			color: white;
			}
			.popup-content.confirm .popup-message {
			color: #555;
			}
			.popup-buttons {
			display: flex;
			justify-content: center;
			gap: 15px;
			}
			.popup-btn {
			padding: 12px 25px;
			border: none;
			border-radius: 8px;
			font-size: 16px;
			cursor: pointer;
			transition: all 0.3s ease;
			font-weight: 600;
			min-width: 100px;
			}
			.popup-btn-primary {
			background-color: #007bff;
			color: white;
			}
			.popup-btn-primary:hover {
			background-color: #0056b3;
			transform: translateY(-2px);
			}
			.popup-btn-secondary {
			background-color: #6c757d;
			color: white;
			}
			.popup-btn-secondary:hover {
			background-color: #5a6268;
			transform: translateY(-2px);
			}
			.popup-btn-success {
			background-color: #28a745;
			color: white;
			}
			.popup-btn-success:hover {
			background-color: #218838;
			transform: translateY(-2px);
			}
			@media only screen and (max-width: 768px) {
			#calendar-body td {
			font-size: 12px; /* Defina o tamanho da fonte desejado */
			}
			table {
			width: 100%;
			font-size: 16px; /* Ajuste o tamanho da fonte para melhor legibilidade */
			}
			table thead th {
			font-size: 11px; /* Defina o tamanho da fonte  */
			padding: 5px; /* Ajuste o espaçamento entre células */
			}
			th, td {
			padding: 10px; /* Ajuste o espaçamento entre células */
			}
			.controls {
			width: 100%; /* Ocupa toda a largura da tela */
			padding: 10px; /* Ajuste o espaçamento */
			}
			.token {
			width: 100%; /* Ocupa toda a largura da tela */
			padding: 10px; /* Ajuste o espaçamento */
			}			
		</style>
	</head>
	<body>
		<div class="mode-container">
			<label class="switch">
			<input type="checkbox" id="mode-toggle">
			<span class="slider round"></span>
			</label>
			<span class="mode-status" id="mode-status">Mode</span>
		</div>
		<h1>Escala de Folgas</h1>        
    	
    <div class="notification">
        <img src="https://cdn.jsdelivr.net/gh/zyon-king/escalas@main/notification-new.svg" alt="Sino Gradient Icon" />
        <span class="counter">
            <img src="https://cdn.jsdelivr.net/gh/zyon-king/escalas@main/counter-new.svg" alt="Counter Icon" />
        </span>
    </div>
        
		<div class="controls">
			<select id="month-select">
				<option value="">Carregando...</option>
			</select>
			<button id="add-schedule-btn">Editar Folgas</button>
		</div>
        
		<div id="loading" class="loading" style="display: none;">Carregando dados...</div>
		<div id="error" class="error" style="display: none;"></div>
        
		<table>
			<thead>
				<tr>
					<th>Dom</th>
					<th>Seg</th>
					<th>Ter</th>
					<th>Qua</th>
					<th>Qui</th>
					<th>Sex</th>
					<th>Sáb</th>
				</tr>
			</thead>
			<tbody id="calendar-body">
			</tbody>
		</table>
		<!-- Modal para adicionar escala -->
		<div id="scheduleModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h2>Editar Folgas</h2>
					<span class="close">&times;</span>
				</div>
				<!-- Primeira etapa: Seleção de dados -->
				<div id="step1" class="modal-step">
					<div class="form-group">
						<label>Selecione a pessoa:</label>
						<div class="person-selection">
							<div class="person-option">
								<input type="radio" id="cris" name="pessoa" value="Cris">
								<label for="cris">Cris</label>
							</div>
							<div class="person-option">
								<input type="radio" id="clei" name="pessoa" value="Clei">
								<label for="clei">Clei</label>
							</div>
						</div>
					</div>
					<div class="form-group">
						<label>Período da escala:</label>
						<div class="date-selection">
							<select id="schedule-month">
								<option value="">Selecione o mês</option>
							</select>
							<select id="schedule-year">
								<option value="">Selecione o ano</option>
							</select>
						</div>
						<div class="toggle-input-link">
						  <a href="#" id="delete-schedule-link" style="color: #dc3545;">Excluir escala</a>
						</div>
					</div>
					<div class="modal-buttons">
						<button class="btn-secondary" id="cancel-btn">Cancelar</button>
						<button class="btn-primary" id="next-btn">Avançar</button>
					</div>
				</div>
				<!-- Segunda etapa: Input das folgas -->
				<div id="step2" class="modal-step" style="display: none;">
					<!-- Seção do calendário (visível por padrão) -->
					<div id="calendar-section">
						<div class="form-group">
							<label>Marque os dias de folga no calendário:</label>
							<div class="editable-calendar">
								<table>
									<thead>
										<tr>
											<th>Dom</th>
											<th>Seg</th>
											<th>Ter</th>
											<th>Qua</th>
											<th>Qui</th>
											<th>Sex</th>
											<th>Sáb</th>
										</tr>
									</thead>
									<tbody id="editable-calendar-body">
									</tbody>
								</table>
							</div>
						</div>
						<div class="toggle-input-link">
							<a href="#" id="show-table-input">Prefere colar tabela HTML?</a>
						</div>
					</div>
					<!-- Seção do textarea (oculta por padrão) -->
					<div id="table-input-section" style="display: none;">
						<div class="form-group">
							<label for="schedule-table">Cole a tabela HTML da escala ou sequência separada por ",":</label>
							<textarea id="schedule-table" placeholder="<table><tbody><tr><td... ou 14, 15,"></textarea>
						</div>
						<div class="toggle-input-link">
							<a href="#" id="show-calendar">Prefere usar o calendário?</a>
						</div>
					</div>
					<div class="modal-buttons">
						<button class="btn-secondary" id="back-btn">Voltar</button>
						<button class="btn-primary" id="save-schedule-btn">Salvar Escala</button>
					</div>
				</div>
			</div>
		</div>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0/dist/umd/sdk.js"></script>
<script>
// 𒅂𒅂𒅂𒅂𒅂𒅂𒅂𒅂𒅂
// Bloco AppWrite | Inicio
// 𒅂𒅂𒅂𒅂𒅂𒅂𒅂𒅂𒅂
// Cliente AppWrite
// Configuração do Appwrite - manter como está no seu código principal
const client = new Appwrite.Client()
    .setEndpoint('https://nyc.cloud.appwrite.io/v1')
    .setProject('686a67d5003a1b4b1bf9');
const account = new Appwrite.Account(client);
const databases = new Appwrite.Databases(client);

const DATABASE_ID = '686a68130002b51fced0';
const COLLECTION_ID = '68c535f2001de9505bde';

/**
 * Salva a escala de folgas no Appwrite Databases.
 * @param {string} pessoa - Nome da pessoa.
 * @param {string} ano - Ano da escala.
 * @param {string} mes - Mês da escala.
 * @param {Array<number>} folgas - Lista de dias de folga.
 * @returns {Promise<void>}
 */
async function saveScheduleAppwrite(pessoa, ano, mes, folgas) {
  try {
    // Busca documento já existente para mesma pessoa, ano e mês,
    // para evitar duplicação e permitir edição da escala existente
    const response = await databases.listDocuments(DATABASE_ID, COLLECTION_ID, [
      Appwrite.Query.equal('people', pessoa),
      Appwrite.Query.equal('year', ano),
      Appwrite.Query.equal('month', mes)
    ]);

    if (response.documents.length > 0) {
      // Atualiza o documento existente
      const documentId = response.documents[0].$id;
      await databases.updateDocument(DATABASE_ID, COLLECTION_ID, documentId, {
        people: pessoa,
        year: ano,
        month: mes,
        daysOff: folgas,
      });
    } else {
      // Cria novo documento
      await databases.createDocument(DATABASE_ID, COLLECTION_ID, 'unique()', {
        people: pessoa,
        year: ano,
        month: mes,
        daysOff: folgas,
      });
    }

  } catch (error) {
    console.error('Erro ao salvar no Appwrite:', error);
    alert('Erro ao salvar escala: ' + error.message);
    throw error; // para tratamento posterior se necessário
  }
}
// 𒅂𒅂𒅂𒅂𒅂𒅂𒅂𒅂𒅂
// Bloco AppWrite | Fim
// 𒅂𒅂𒅂𒅂𒅂𒅂𒅂𒅂𒅂

const FolgasEditor = (() => {
  // Estado interno da edição
  let state = {
    isModalOpen: false,
    pessoaSelecionada: null,
    mesSelecionado: null,
    anoSelecionado: null,
    folgasSelecionadas: new Set(),
  };

  // Cache de elementos DOM
  const elements = {
    modal: document.getElementById('scheduleModal'),
    closeBtn: document.querySelector('#scheduleModal .close'),
    nextBtn: document.getElementById('next-btn'),
    cancelBtn: document.getElementById('cancel-btn'),
    backBtn: document.getElementById('back-btn'),
    saveBtn: document.getElementById('save-schedule-btn'),
    pessoaRadios: document.querySelectorAll('input[name="pessoa"]'),
    monthSelect: document.getElementById('schedule-month'),
    yearSelect: document.getElementById('schedule-year'),
    editableCalendarBody: document.getElementById('editable-calendar-body'),
    step1: document.getElementById('step1'),
    step2: document.getElementById('step2'),
    // Outras referências conforme necessário
  };

  // Função para abrir modal com inicialização
  function openModal() {
    loadSelectOptions();
    clearState();
    renderStep1();
    elements.modal.style.display = 'block';
    state.isModalOpen = true;
    attachListeners();
  }

  // Função para fechar modal e limpar listeners
  function closeModal() {
    elements.modal.style.display = 'none';
    state.isModalOpen = false;
    detachListeners();
  }

  // Limpa o estado antes de nova edição
  function clearState() {
    state.pessoaSelecionada = null;
    state.mesSelecionado = null;
    state.anoSelecionado = null;
    state.folgasSelecionadas.clear();
    // Reset inputs
    elements.pessoaRadios.forEach(radio => radio.checked = false);
    elements.monthSelect.value = '';
    elements.yearSelect.value = '';
  }

  // Inicializa opções dos selects mês e ano (exemplo)
  function loadSelectOptions() {
    // Aqui pode-se carregar meses e anos dinamicamente conforme necessidade
    // Exemplo simples:
    if (elements.monthSelect.options.length <= 1) {
      const meses = [
        'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
        'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
      ];
      meses.forEach((mes, i) => {
        const option = new Option(mes, i + 1);
        elements.monthSelect.add(option);
      });
    }
    if (elements.yearSelect.options.length <= 1) {
      const anoAtual = new Date().getFullYear();
      for (let ano = anoAtual - 5; ano <= anoAtual + 5; ano++) {
        const option = new Option(ano, ano);
        elements.yearSelect.add(option);
      }
    }
  }

  // Renderiza primeira etapa (seleção)
  function renderStep1() {
    elements.step1.style.display = 'block';
    elements.step2.style.display = 'none';
  }

  // Renderiza segunda etapa (calendário ou textarea)
  function renderStep2() {
    elements.step1.style.display = 'none';
    elements.step2.style.display = 'block';
    renderEditableCalendar();
  }

  // Exemplo simples para montar calendário editável
  function renderEditableCalendar() {
    const mes = Number(elements.monthSelect.value);
    const ano = Number(elements.yearSelect.value);
    if (!mes || !ano) return;

    // Limpa calendário atual
    elements.editableCalendarBody.innerHTML = '';

    // Obter número de dias no mês
    const diasNoMes = new Date(ano, mes, 0).getDate();

    // Gerar linhas e células para cada dia (simples, por semana)
    let diaAtual = 1;
    while (diaAtual <= diasNoMes) {
      const row = document.createElement('tr');
      for (let i = 0; i < 7; i++) {
        const cell = document.createElement('td');
        if (diaAtual <= diasNoMes) {
          // Checkbox para marcar folga do dia
          const label = document.createElement('label');
          label.classList.add('day-checkbox');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.value = diaAtual;
          checkbox.checked = state.folgasSelecionadas.has(diaAtual);
          checkbox.addEventListener('change', () => {
            if (checkbox.checked) {
              state.folgasSelecionadas.add(diaAtual);
            } else {
              state.folgasSelecionadas.delete(diaAtual);
            }
          });

          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(diaAtual));
          cell.appendChild(label);
          diaAtual++;
        } else {
          cell.classList.add('empty');
        }
        row.appendChild(cell);
      }
      elements.editableCalendarBody.appendChild(row);
    }
  }

  // Validação de seleção da primeira etapa
  function validateStep1() {
    state.pessoaSelecionada = Array.from(elements.pessoaRadios).find(r => r.checked)?.value || null;
    state.mesSelecionado = elements.monthSelect.value || null;
    state.anoSelecionado = elements.yearSelect.value || null;

    if (!state.pessoaSelecionada) {
      alert('Por favor, selecione a pessoa.');
      return false;
    }
    if (!state.mesSelecionado) {
      alert('Por favor, selecione o mês.');
      return false;
    }
    if (!state.anoSelecionado) {
      alert('Por favor, selecione o ano.');
      return false;
    }
    return true;
  }

  // Funções de callback para os eventos
  const handleNext = () => {
    if (validateStep1()) {
      renderStep2();
    }
  };

  // Attach global listeners durante modal aberta
  function attachListeners() {
    elements.closeBtn.addEventListener('click', closeModal);
    elements.cancelBtn.addEventListener('click', closeModal);
    elements.nextBtn.addEventListener('click', handleNext);
    elements.backBtn.addEventListener('click', renderStep1);
    elements.saveBtn.addEventListener('click', saveSchedule);
  }

  // Remove listeners para evitar duplicação
  function detachListeners() {
    elements.closeBtn.removeEventListener('click', closeModal);
    elements.cancelBtn.removeEventListener('click', closeModal);
    elements.nextBtn.removeEventListener('click', handleNext);
    elements.backBtn.removeEventListener('click', renderStep1);
    elements.saveBtn.removeEventListener('click', saveSchedule);
  }

  // Simulação de salvar a escala
  function saveSchedule() {
    if (state.folgasSelecionadas.size === 0) {
      alert('Por favor, selecione pelo menos um dia de folga.');
      return;
    }
    // Aqui incluir a lógica para salvar dados (ex: API, localStorage...)
    console.log('Salvando escala para:', {
      pessoa: state.pessoaSelecionada,
      mes: state.mesSelecionado,
      ano: state.anoSelecionado,
      folgas: Array.from(state.folgasSelecionadas).sort((a,b) => a-b),
    });
    alert('Escala salva com sucesso!');
    closeModal();
  }

  return {
    openModal,
  };
})();

// Para abrir a edição de folgas
document.getElementById('add-schedule-btn').addEventListener('click', () => {
  FolgasEditor.openModal();
});
    </script>
  </body>
</html>
